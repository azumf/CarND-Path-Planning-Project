# Write up Path Planning project
(c) Alexander Fuchs

# Source Code 


## Vehicle Class
The Vehicle Class is the main object to plan the vehicle behaviour. 
To plan the ego car behaviour a Finite State Machine (FSM) is used to handle the transition of multiple possible states. I oriented myself on the lessons from the classroom. The possible states are:

- Keep Lane
- Prepare Lane Change Left
- Prepare lane Change Right
- Lane Change Left
- Lane Change Right

The Vehicle class has following functions:

### Surroundings and kinematics:

##### `is_vehicle_ahead`
Returns true if a vehicle is ahead, otherwise returns false.

##### `is_vehicle_behind`
Returns true if a vehicle is behind, otherwise returns false.

##### `get_kinematics`
Defines the next time step kinematics (s, d, v, a) for a given lane. The functions calculates the max. speed and acceleration, given the position, speed and acceleration of other vehicles.

### Predictions and trajectory generation:

#### `generate_predictions`

Genereates predictions for other vehicles on the highway. This information is going to be used for the trajectory generation of the ego vehicle.

##### `generate_trajectory`

Given a possible next state the trajectory is generated by this function to realize the next state.

##### `choose_next_state`

The next state of the ego vehicle is computed via the FSM.

##### `generate_path_points` 

Valid trajectories are generated based on the chosen next state. Spline fitting is used as described in the project walkthrough.

##### `successor_states`

The next possible states are provided by the current state of the FSM (current state is given).

##### `realize_next_state`

The next state is realized.


### Trajectories:

##### `keep_lane_trajectory`
Calculates a trajectory to keep the current lane as intended lane.
##### `constant_speed_trajectory`
Calculates a trajectory to drive with constand speed.
##### `lane_change_trajectory`
Calculates a trajectory to change the lane.
##### `prep_lane_change_trajectory`
Calculates a trajectory to prepare a lane change before changing the lane. Keeps track of other vehicles.

### Behaviour Planning - Finite State Machine

The Finit State Machine handels the state transition with respect to cost functions. It chooses the most appropriate trajectory to achieve the target state with minimum cost.


### Trajectory Generation

Since the available waypoints of the map are not sufficient to estimate the location of points and vehicle position in terms of safety, interpolating of the position of these waypoints is necessary.
Therefore either a polynomial fitting can be employed, but in this case a spline fitting approach is used.

### Cost Functions
Two cost functions are used to evaluate the possible trajectories. 
##### `distance_cost`
The cost is increased based on distance of current lane and target lane.
##### `inefficiency_cost`
Cost is increased for trajectories for lanes with slower traffic.
##### `get_helper_data`
Provides some preprocessing of vehicle data that is useful in the cost functions. They include intended_lane, final_lane, and distance_to_goal.
##### `calculate_cost()`
computes the cost for a trajectory